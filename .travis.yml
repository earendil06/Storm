before_install:
  - openssl aes-256-cbc -K $encrypted_80b985043969_key -iv $encrypted_80b985043969_iv -in deploy_rsa.enc -out /tmp/deploy_rsa -d
  - eval "$(ssh-agent -s)"
  - chmod 600 /tmp/deploy_rsa
  - ssh-add /tmp/deploy_rsa

addons:
  ssh_known_hosts:
  - ssh.cluster026.hosting.ovh.net

jobs:
  include:
  - stage: build
    language: node_js
    node_js: 8
    cache:
      directories:
      - ./StormWeb/node_modules
    script:
    - cd StormWeb
    - npm install
    - npm i typescript --save-dev
    - npm run build
    after_success:
    - zip -r stormweb.zip ./*
    - scp stormweb.zip florentpgd@ssh.cluster026.hosting.ovh.net:~/storm-deploy

  -
    language: scala
    scala:
    - 2.12.4
    cache:
      directories:
      - ~/.sbt
      - ~/.ivy2
    script:
    - cd engine
    - sbt "fastOptJS"
    - cd ..
    after_success:
    - scp ./target/scala-2.12/engine-fastopt.js florentpgd@ssh.cluster026.hosting.ovh.net:~/storm-deploy

  - stage: deploy
    language: shell
    if: branch = master
    script:
    - ssh florentpgd@ssh.cluster026.hosting.ovh.net "./deploy.sh"


#  - stage: deploy
#    language: node_js
#    node_js: 8
#    cache:
#    directories:
#    - ./StormWeb/node_modules
#    if: branch = master
#    script:
#    - cd StormWeb
#    - npm install
#    - npm run package
#    - cd releases
#    - zip -r electron.zip storm-linux-x64
#    deploy:
#      provider: releases
#      api_key:
#        secure: J1ZqxVL4P3yw9iZ9r3h/DTFh3AJilGuBk13IaLgTyIftaIK+mzmPd4+b95yk3UiW+UCmJqHFozJaSeD3ggTwKAhwc6mDSjSfg79R77MvwOuc1yDW3tKSW8RKSZ8lvw4C819/mkQB9zrP/HHXSjbaAGHZxGZ7jEllSt8AJgpp59H0gjokiL/tcNAzsADpjWSo0PAcJUTPaliEPm4uMm5k2NF04AnJ+UvULwxUSaYNQf0IwJ4/OukzWy96vz0rTdlZyI3LqcLrSFA5EP3/SvSTu05wnmSeMhoCQXGO8giziGn7F23Venps3zhBXOJr3gw0t6HCUoGaNJXUVApvcLv74QY49JVlZSvUZogNcdf5OHG58/zA1LfaU4nSKJ50pGSfJdSmfob6HhN+YAwXWIHnA5PEsEwxyCLvqGqmzpUxolQfrj4PFSruVU0O3pvbbkqehlDaWfcvUh4lbnES6hYpHq44/nzggyLbuDYDQuNTSqjW9HSH2OZohLVWAs4U6sddJJbAsYUzFzqUtqIhyQwZxqDcwZtWVTBD6ko06/0SAcNBEuxcUxGQR1cgWZ+1vZf8BVM7c42S8V37hEDsQMlqTG7LK235ylFL8TeCgQGHh6cGF65TAKuAqSQvq9w7aU5+DcaPJPCQNk+0ob58VZRfApNGap8rUaDCc/M4mzeBlTk=
#      file: ~/Storm/StormWeb/releases/electron.zip
#      on:
#        repo: earendil06/Storm
#      skip_cleanup: true

notifications:
  email: false

after_success:
- wget https://raw.githubusercontent.com/k3rn31p4nic/travis-ci-discord-webhook/master/send.sh
- chmod +x send.sh
- ./send.sh success $WEBHOOK_URL
after_failure:
- wget https://raw.githubusercontent.com/k3rn31p4nic/travis-ci-discord-webhook/master/send.sh
- chmod +x send.sh
- ./send.sh failure $WEBHOOK_URL

